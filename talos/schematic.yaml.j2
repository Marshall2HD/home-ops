---
customization:
  extraKernelArgs:
    - -init_on_alloc # Less security, faster puter
    - -init_on_free # Less security, faster puter
    - -selinux # Less security, faster puter
    - apparmor=0 # Less security, faster puter
    - init_on_alloc=0 # Less security, faster puter
    - init_on_free=0 # Less security, faster puter
    - intel_iommu=on # PCI Passthrough
    - iommu=pt # PCI Passthrough
    - pcie_aspm=off # Disable PCIe ASPM
    - mitigations=off # Less security, faster puter
    - security=none # Less security, faster puter
    - sysctl.kernel.kexec_load_disabled=1  # Security hardening
    - amdgpu.ppfeaturemask=0xffffffff      # Enable all AMD GPU features
    - amd_pstate=active                    # Better CPU frequency scaling for Zen 5
    - amd_iommu=on                         # Enable IOMMU
    - iommu=pt                             # Passthrough mode for performance
    - amd_pstate.shared_mem=1              # Shared memory for P-State driver
    - initcall_blacklist=acpi_cpufreq_init # Prevent conflict with amd_pstate
    - nvidia-drm.modeset=1                 # Enable DRM kernel mode setting
    - nvidia.NVreg_EnableGpuFirmware=1     # Enable GPU firmware
    - nvidia.NVreg_PreserveVideoMemoryAllocations=1  # GPU memory persistence
    - talos.auditd.disabled=1 # Less security, faster puter
  systemExtensions:
    officialExtensions:
      - siderolabs/amd-ucode # AMD CPU microcode
      - siderolabs/amdgpu # AMD GPU drivers
      - siderolabs/nfsrahead # NFS Performance
      - siderolabs/thunderbolt # Thunderbolt/USB4 NICs
      - siderolabs/nonfree-kmod-nvidia-production # NVIDIA GPU drivers
      - siderolabs/nvidia-container-toolkit-production # NVIDIA GPU support
